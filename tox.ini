[tox]
isolated_build = True
envlist =
    pre-commit
    check-licenses
    py{38,39,310,311}

[gh-actions]
python =
    3.8: py38
    3.9: py39
    3.10: pre-commit,check-licenses, py310
    3.11: py311

[testenv:pre-commit]
deps=pre-commit
commands=pre-commit run --all-files --show-diff-on-failure

[testenv:check-licenses]
deps=
    liccheck==0.7.3
commands=
    poetry lock
    poetry install --all-extras
    poetry show
    poetry export -f requirements.txt --output /tmp/requirements.txt
    poetry run liccheck -s license_strategy.ini -r /tmp/requirements.txt -l PARANOID

[testenv]
setenv=PYTHONPATH = {toxinidir}:{toxinidir}
deps=
    pytest==7.4.0
    pytest-cov==4.1.0
allowlist_externals=
    poetry
    /usr/bin/bash
commands=
    bash ./scripts/pre-build.sh
    poetry lock
    poetry install --all-extras
    poetry show
    poetry run python -m pytest tests --cov fondant --cov-report term-missing
