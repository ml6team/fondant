# PIPELINE DEFINITION
# Name: testpipeline
# Description: description of the test pipeline
components:
  comp-First_component:
    executorLabel: exec-First_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
  comp-Second_component:
    executorLabel: exec-Second_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
  comp-Third_component:
    executorLabel: exec-Third_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
  comp-first-component:
    dag:
      outputs:
        artifacts:
          output_manifest_path:
            artifactSelectors:
            - outputArtifactKey: output_manifest_path
              producerSubtask: First_component
      tasks:
        First_component:
          cachingOptions:
            enableCache: true
          componentRef:
            name: comp-First_component
          inputs:
            artifacts:
              input_manifest_path:
                componentInputArtifact: input_manifest_path
            parameters:
              cache:
                componentInputParameter: cache
              component_spec:
                componentInputParameter: component_spec
              input_partition_rows:
                componentInputParameter: input_partition_rows
              metadata:
                componentInputParameter: metadata
          taskInfo:
            name: First_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
  comp-second-component:
    dag:
      outputs:
        artifacts:
          output_manifest_path:
            artifactSelectors:
            - outputArtifactKey: output_manifest_path
              producerSubtask: Second_component
      tasks:
        Second_component:
          cachingOptions:
            enableCache: true
          componentRef:
            name: comp-Second_component
          inputs:
            artifacts:
              input_manifest_path:
                componentInputArtifact: input_manifest_path
            parameters:
              cache:
                componentInputParameter: cache
              component_spec:
                componentInputParameter: component_spec
              input_partition_rows:
                componentInputParameter: input_partition_rows
              metadata:
                componentInputParameter: metadata
          taskInfo:
            name: Second_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
  comp-third-component:
    dag:
      outputs:
        artifacts:
          output_manifest_path:
            artifactSelectors:
            - outputArtifactKey: output_manifest_path
              producerSubtask: Third_component
      tasks:
        Third_component:
          cachingOptions:
            enableCache: true
          componentRef:
            name: comp-Third_component
          inputs:
            artifacts:
              input_manifest_path:
                componentInputArtifact: input_manifest_path
            parameters:
              cache:
                componentInputParameter: cache
              component_spec:
                componentInputParameter: component_spec
              input_partition_rows:
                componentInputParameter: input_partition_rows
              metadata:
                componentInputParameter: metadata
          taskInfo:
            name: Third_component
    inputDefinitions:
      artifacts:
        input_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the input manifest
          isOptional: true
      parameters:
        cache:
          defaultValue: true
          description: Set to False to disable caching, True by default.
          isOptional: true
          parameterType: BOOLEAN
        component_spec:
          defaultValue: {}
          description: The component specification as a dictionary
          isOptional: true
          parameterType: STRUCT
        input_partition_rows:
          defaultValue: None
          description: The number of rows to load per partition. Set to override the
            automatic partitioning
          isOptional: true
          parameterType: STRING
        metadata:
          description: Metadata arguments containing the run id and base path
          parameterType: STRING
        storage_args:
          description: Storage arguments
          parameterType: STRING
    outputDefinitions:
      artifacts:
        output_manifest_path:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
          description: Path to the output manifest
deploymentSpec:
  executors:
    exec-First_component:
      container:
        args:
        - --input_manifest_path
        - '{{$.inputs.artifacts[''input_manifest_path''].uri}}'
        - --metadata
        - '{{$.inputs.parameters[''metadata'']}}'
        - --component_spec
        - '{{$.inputs.parameters[''component_spec'']}}'
        - --input_partition_rows
        - '{{$.inputs.parameters[''input_partition_rows'']}}'
        - --cache
        - '{{$.inputs.parameters[''cache'']}}'
        - --storage_args
        - '{{$.inputs.parameters[''storage_args'']}}'
        - --output_manifest_path
        - '{{$.outputs.artifacts[''output_manifest_path''].uri}}'
        command:
        - python3
        - main.py
        image: example_component:latest
    exec-Second_component:
      container:
        args:
        - --input_manifest_path
        - '{{$.inputs.artifacts[''input_manifest_path''].uri}}'
        - --metadata
        - '{{$.inputs.parameters[''metadata'']}}'
        - --component_spec
        - '{{$.inputs.parameters[''component_spec'']}}'
        - --input_partition_rows
        - '{{$.inputs.parameters[''input_partition_rows'']}}'
        - --cache
        - '{{$.inputs.parameters[''cache'']}}'
        - --storage_args
        - '{{$.inputs.parameters[''storage_args'']}}'
        - --output_manifest_path
        - '{{$.outputs.artifacts[''output_manifest_path''].uri}}'
        command:
        - python3
        - main.py
        image: example_component:latest
    exec-Third_component:
      container:
        args:
        - --input_manifest_path
        - '{{$.inputs.artifacts[''input_manifest_path''].uri}}'
        - --metadata
        - '{{$.inputs.parameters[''metadata'']}}'
        - --component_spec
        - '{{$.inputs.parameters[''component_spec'']}}'
        - --input_partition_rows
        - '{{$.inputs.parameters[''input_partition_rows'']}}'
        - --cache
        - '{{$.inputs.parameters[''cache'']}}'
        - --storage_args
        - '{{$.inputs.parameters[''storage_args'']}}'
        - --output_manifest_path
        - '{{$.outputs.artifacts[''output_manifest_path''].uri}}'
        command:
        - python3
        - main.py
        image: example_component:latest
pipelineInfo:
  description: description of the test pipeline
  name: testpipeline
root:
  dag:
    tasks:
      first-component:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-first-component
        inputs:
          parameters:
            cache:
              runtimeValue:
                constant: false
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  description: This is an example component
                  image: example_component:latest
                  name: First component
                  produces:
                    captions:
                      fields:
                        data:
                          type: string
                    images:
                      fields:
                        data:
                          type: binary
            input_partition_rows:
              runtimeValue:
                constant: disable
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "first_component",
                  "cache_key": "1"}'
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: first-component
      second-component:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-second-component
        dependentTasks:
        - first-component
        inputs:
          artifacts:
            input_manifest_path:
              taskOutputArtifact:
                outputArtifactKey: output_manifest_path
                producerTask: first-component
          parameters:
            cache:
              runtimeValue:
                constant: false
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  consumes:
                    images:
                      fields:
                        data:
                          type: binary
                  description: This is an example component
                  image: example_component:latest
                  name: Second component
                  produces:
                    embeddings:
                      fields:
                        data:
                          items:
                            type: float32
                          type: array
            input_partition_rows:
              runtimeValue:
                constant: '10'
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "second_component",
                  "cache_key": "2"}'
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: second-component
      third-component:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-third-component
        dependentTasks:
        - second-component
        inputs:
          artifacts:
            input_manifest_path:
              taskOutputArtifact:
                outputArtifactKey: output_manifest_path
                producerTask: second-component
          parameters:
            cache:
              runtimeValue:
                constant: false
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  consumes:
                    captions:
                      fields:
                        data:
                          type: string
                    embeddings:
                      fields:
                        data:
                          items:
                            type: float32
                          type: array
                    images:
                      fields:
                        data:
                          type: binary
                  description: This is an example component
                  image: example_component:latest
                  name: Third component
                  produces:
                    additionalSubsets: false
                    images:
                      fields:
                        data:
                          type: binary
            input_partition_rows:
              runtimeValue:
                constant: None
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "third_component",
                  "cache_key": "3"}'
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: third-component
schemaVersion: 2.1.0
sdkVersion: kfp-2.0.1
