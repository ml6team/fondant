# PIPELINE DEFINITION
# Name: testpipeline
# Description: description of the test pipeline
components:
  comp-first-component:
    executorLabel: exec-first-component
    inputDefinitions:
      parameters:
        cache:
          defaultValue: true
          isOptional: true
          parameterType: BOOLEAN
        cluster_type:
          defaultValue: default
          isOptional: true
          parameterType: STRING
        component_spec:
          parameterType: STRUCT
        input_manifest_path:
          isOptional: true
          parameterType: STRING
        input_partition_rows:
          defaultValue: -1
          isOptional: true
          parameterType: NUMBER_INTEGER
        metadata:
          parameterType: STRING
        output_manifest_path:
          parameterType: STRING
        storage_args:
          parameterType: STRING
  comp-second-component:
    executorLabel: exec-second-component
    inputDefinitions:
      parameters:
        cache:
          defaultValue: true
          isOptional: true
          parameterType: BOOLEAN
        cluster_type:
          defaultValue: default
          isOptional: true
          parameterType: STRING
        component_spec:
          parameterType: STRUCT
        input_manifest_path:
          isOptional: true
          parameterType: STRING
        input_partition_rows:
          defaultValue: -1
          isOptional: true
          parameterType: NUMBER_INTEGER
        metadata:
          parameterType: STRING
        output_manifest_path:
          parameterType: STRING
        storage_args:
          parameterType: STRING
  comp-third-component:
    executorLabel: exec-third-component
    inputDefinitions:
      parameters:
        cache:
          defaultValue: true
          isOptional: true
          parameterType: BOOLEAN
        cluster_type:
          defaultValue: default
          isOptional: true
          parameterType: STRING
        component_spec:
          parameterType: STRUCT
        input_manifest_path:
          isOptional: true
          parameterType: STRING
        input_partition_rows:
          defaultValue: -1
          isOptional: true
          parameterType: NUMBER_INTEGER
        metadata:
          parameterType: STRING
        output_manifest_path:
          parameterType: STRING
        storage_args:
          parameterType: STRING
deploymentSpec:
  executors:
    exec-first-component:
      container:
        args:
        - "--input_manifest_path"
        - "{{$.inputs.parameters['input_manifest_path']}}"
        - "--component_spec"
        - "{{$.inputs.parameters['component_spec']}}"
        - "--input_partition_rows"
        - "{{$.inputs.parameters['input_partition_rows']}}"
        - "--cache"
        - "{{$.inputs.parameters['cache']}}"
        - "--cluster_type"
        - "{{$.inputs.parameters['cluster_type']}}"
        - "--metadata"
        - "{{$.inputs.parameters['metadata']}}"
        - "--output_manifest_path"
        - "{{$.inputs.parameters['output_manifest_path']}}"
        - "--storage_args"
        - "{{$.inputs.parameters['storage_args']}}"
        command:
        - fondant
        - execute
        - main
        image: example_component:latest
    exec-second-component:
      container:
        args:
        - "--input_manifest_path"
        - "{{$.inputs.parameters['input_manifest_path']}}"
        - "--component_spec"
        - "{{$.inputs.parameters['component_spec']}}"
        - "--input_partition_rows"
        - "{{$.inputs.parameters['input_partition_rows']}}"
        - "--cache"
        - "{{$.inputs.parameters['cache']}}"
        - "--cluster_type"
        - "{{$.inputs.parameters['cluster_type']}}"
        - "--metadata"
        - "{{$.inputs.parameters['metadata']}}"
        - "--output_manifest_path"
        - "{{$.inputs.parameters['output_manifest_path']}}"
        - "--storage_args"
        - "{{$.inputs.parameters['storage_args']}}"
        command:
        - fondant
        - execute
        - main
        image: example_component:latest
    exec-third-component:
      container:
        args:
        - "--input_manifest_path"
        - "{{$.inputs.parameters['input_manifest_path']}}"
        - "--component_spec"
        - "{{$.inputs.parameters['component_spec']}}"
        - "--input_partition_rows"
        - "{{$.inputs.parameters['input_partition_rows']}}"
        - "--cache"
        - "{{$.inputs.parameters['cache']}}"
        - "--cluster_type"
        - "{{$.inputs.parameters['cluster_type']}}"
        - "--metadata"
        - "{{$.inputs.parameters['metadata']}}"
        - "--output_manifest_path"
        - "{{$.inputs.parameters['output_manifest_path']}}"
        - "--storage_args"
        - "{{$.inputs.parameters['storage_args']}}"
        command:
        - fondant
        - execute
        - main
        image: example_component:latest
pipelineInfo:
  description: description of the test pipeline
  name: testpipeline
root:
  dag:
    tasks:
      first-component:
        cachingOptions: {}
        componentRef:
          name: comp-first-component
        inputs:
          parameters:
            cache:
              runtimeValue:
                constant: false
            cluster_type:
              runtimeValue:
                constant: default
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  description: This is an example component
                  image: example_component:latest
                  name: First component
                  produces:
                    captions:
                      fields:
                        data:
                          type: string
                    images:
                      fields:
                        data:
                          type: binary
            input_partition_rows:
              runtimeValue:
                constant: 10.0
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "first_component",
                  "cache_key": "1"}'
            output_manifest_path:
              runtimeValue:
                constant: "/foo/bar/testpipeline/testpipeline-20230101000000/first_component/manifest.json"
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: first-component
      second-component:
        cachingOptions: {}
        componentRef:
          name: comp-second-component
        dependentTasks:
        - first-component
        inputs:
          parameters:
            cache:
              runtimeValue:
                constant: false
            cluster_type:
              runtimeValue:
                constant: default
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  consumes:
                    images:
                      fields:
                        data:
                          type: binary
                  description: This is an example component
                  image: example_component:latest
                  name: Second component
                  produces:
                    embeddings:
                      fields:
                        data:
                          items:
                            type: float32
                          type: array
            input_manifest_path:
              runtimeValue:
                constant: "/foo/bar/testpipeline/testpipeline-20230101000000/first_component/manifest.json"
            input_partition_rows:
              runtimeValue:
                constant: 10.0
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "second_component",
                  "cache_key": "2"}'
            output_manifest_path:
              runtimeValue:
                constant: "/foo/bar/testpipeline/testpipeline-20230101000000/second_component/manifest.json"
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: second-component
      third-component:
        cachingOptions: {}
        componentRef:
          name: comp-third-component
        dependentTasks:
        - second-component
        inputs:
          parameters:
            cache:
              runtimeValue:
                constant: false
            cluster_type:
              runtimeValue:
                constant: default
            component_spec:
              runtimeValue:
                constant:
                  args:
                    storage_args:
                      description: Storage arguments
                      type: str
                  consumes:
                    captions:
                      fields:
                        data:
                          type: string
                    embeddings:
                      fields:
                        data:
                          items:
                            type: float32
                          type: array
                    images:
                      fields:
                        data:
                          type: binary
                  description: This is an example component
                  image: example_component:latest
                  name: Third component
                  produces:
                    additionalSubsets: false
                    images:
                      fields:
                        data:
                          type: binary
            input_manifest_path:
              runtimeValue:
                constant: "/foo/bar/testpipeline/testpipeline-20230101000000/second_component/manifest.json"
            metadata:
              runtimeValue:
                constant: '{"base_path": "/foo/bar", "pipeline_name": "testpipeline",
                  "run_id": "testpipeline-20230101000000", "component_id": "third_component",
                  "cache_key": "3"}'
            output_manifest_path:
              runtimeValue:
                constant: "/foo/bar/testpipeline/testpipeline-20230101000000/third_component/manifest.json"
            storage_args:
              runtimeValue:
                constant: a dummy string arg
        taskInfo:
          name: third-component
schemaVersion: 2.1.0
sdkVersion: kfp-2.3.0
