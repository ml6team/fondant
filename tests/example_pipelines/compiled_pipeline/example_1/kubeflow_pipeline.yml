apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  annotations:
    pipelines.kubeflow.org/kfp_sdk_version: 1.8.22
    pipelines.kubeflow.org/pipeline_compilation_time: '2023-01-01T00:00:00'
    pipelines.kubeflow.org/pipeline_spec: '{"description": "description of the test
      pipeline", "name": "test_pipeline"}'
  generateName: test-pipeline-
  labels:
    pipelines.kubeflow.org/kfp_sdk_version: 1.8.22
spec:
  arguments:
    parameters: []
  entrypoint: test-pipeline
  serviceAccountName: pipeline-runner
  templates:
  - affinity:
      nodeAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - preference:
            matchExpressions:
            - key: cloud.google.com/gke-preemptible
              operator: In
              values:
              - 'true'
          weight: 50
    container:
      args: []
      command:
      - fondant
      - execute
      - main
      - --input_manifest_path
      - /tmp/inputs/input_manifest_path/data
      - --metadata
      - '{"base_path": "/foo/bar", "pipeline_name": "test_pipeline", "run_id": "test_pipeline-20230101000000",
        "component_id": "first_component", "cache_key": "1"}'
      - --component_spec
      - '{"args": {"storage_args": {"description": "Storage arguments", "type": "str"}},
        "description": "This is an example component", "image": "example_component:latest",
        "name": "First component", "produces": {"captions": {"fields": {"data": {"type":
        "string"}}}, "images": {"fields": {"data": {"type": "binary"}}}}}'
      - --input_partition_rows
      - disable
      - --column_mapping
      - None
      - --cache
      - 'True'
      - --storage_args
      - a dummy string arg
      - --output_manifest_path
      - /tmp/outputs/output_manifest_path/data
      - --cluster_type
      - default
      - --client_kwargs
      - '{}'
      image: example_component:latest
      imagePullPolicy: Always
      resources:
        limits:
          nvidia.com/gpu: 1
    inputs:
      artifacts:
      - name: input_manifest_path
        path: /tmp/inputs/input_manifest_path/data
        raw:
          data: ''
    metadata:
      annotations:
        pipelines.kubeflow.org/arguments.parameters: '{"cache": "True", "client_kwargs":
          "{}", "cluster_type": "default", "column_mapping": "None", "component_spec":
          "{\"args\": {\"storage_args\": {\"description\": \"Storage arguments\",
          \"type\": \"str\"}}, \"description\": \"This is an example component\",
          \"image\": \"example_component:latest\", \"name\": \"First component\",
          \"produces\": {\"captions\": {\"fields\": {\"data\": {\"type\": \"string\"}}},
          \"images\": {\"fields\": {\"data\": {\"type\": \"binary\"}}}}}", "input_partition_rows":
          "disable", "metadata": "{\"base_path\": \"/foo/bar\", \"pipeline_name\":
          \"test_pipeline\", \"run_id\": \"test_pipeline-20230101000000\", \"component_id\":
          \"first_component\", \"cache_key\": \"1\"}", "storage_args": "a dummy string
          arg"}'
        pipelines.kubeflow.org/component_ref: '{"digest": "e3d21e0a996f5353472773c6ba51d1601724bd104fa9a3f56c2dbd3a7ce85cc7"}'
        pipelines.kubeflow.org/component_spec: '{"description": "This is an example
          component", "implementation": {"container": {"command": ["fondant", "execute",
          "main", "--input_manifest_path", {"inputPath": "input_manifest_path"}, "--metadata",
          {"inputValue": "metadata"}, "--component_spec", {"inputValue": "component_spec"},
          "--input_partition_rows", {"inputValue": "input_partition_rows"}, "--column_mapping",
          {"inputValue": "column_mapping"}, "--cache", {"inputValue": "cache"}, "--storage_args",
          {"inputValue": "storage_args"}, "--output_manifest_path", {"outputPath":
          "output_manifest_path"}, "--cluster_type", {"inputValue": "cluster_type"},
          "--client_kwargs", {"inputValue": "client_kwargs"}], "image": "example_component:latest"}},
          "inputs": [{"description": "Path to the input manifest", "name": "input_manifest_path",
          "type": "String"}, {"description": "Metadata arguments containing the run
          id and base path", "name": "metadata", "type": "String"}, {"default": "None",
          "description": "The component specification as a dictionary", "name": "component_spec",
          "type": "JsonObject"}, {"default": "None", "description": "The number of
          rows to load per partition. Set to override the automatic partitioning",
          "name": "input_partition_rows", "type": "String"}, {"default": "None", "description":
          "A dictionary that maps the column names of the consumed dataset to other
          column names that match a given component specification", "name": "column_mapping",
          "type": "JsonObject"}, {"default": "True", "description": "Set to False
          to disable caching, True by default.", "name": "cache", "type": "Boolean"},
          {"default": "default", "description": "The type of cluster to use for distributed
          execution", "name": "cluster_type", "type": "String"}, {"default": "{}",
          "description": "Keyword arguments used to initialise the dask client", "name":
          "client_kwargs", "type": "JsonObject"}, {"description": "Storage arguments",
          "name": "storage_args", "type": "String"}], "name": "First component", "outputs":
          [{"description": "Path to the output manifest", "name": "output_manifest_path",
          "type": "String"}]}'
      labels:
        pipelines.kubeflow.org/enable_caching: 'true'
        pipelines.kubeflow.org/kfp_sdk_version: 1.8.22
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
    name: first-component
    outputs:
      artifacts:
      - name: first-component-output_manifest_path
        path: /tmp/outputs/output_manifest_path/data
    tolerations:
    - effect: NoSchedule
      key: preemptible
      operator: Equal
      value: 'true'
  - container:
      args: []
      command:
      - fondant
      - execute
      - main
      - --input_manifest_path
      - /tmp/inputs/input_manifest_path/data
      - --metadata
      - '{"base_path": "/foo/bar", "pipeline_name": "test_pipeline", "run_id": "test_pipeline-20230101000000",
        "component_id": "second_component", "cache_key": "2"}'
      - --component_spec
      - '{"args": {"storage_args": {"description": "Storage arguments", "type": "str"}},
        "consumes": {"images": {"fields": {"data": {"type": "binary"}}}}, "description":
        "This is an example component", "image": "example_component:latest", "name":
        "Second component", "produces": {"embeddings": {"fields": {"data": {"items":
        {"type": "float32"}, "type": "array"}}}}}'
      - --input_partition_rows
      - '10'
      - --column_mapping
      - None
      - --cache
      - 'True'
      - --storage_args
      - a dummy string arg
      - --output_manifest_path
      - /tmp/outputs/output_manifest_path/data
      - --cluster_type
      - default
      - --client_kwargs
      - '{}'
      image: example_component:latest
      imagePullPolicy: Always
    inputs:
      artifacts:
      - name: first-component-output_manifest_path
        path: /tmp/inputs/input_manifest_path/data
    metadata:
      annotations:
        pipelines.kubeflow.org/arguments.parameters: '{"cache": "True", "client_kwargs":
          "{}", "cluster_type": "default", "column_mapping": "None", "component_spec":
          "{\"args\": {\"storage_args\": {\"description\": \"Storage arguments\",
          \"type\": \"str\"}}, \"consumes\": {\"images\": {\"fields\": {\"data\":
          {\"type\": \"binary\"}}}}, \"description\": \"This is an example component\",
          \"image\": \"example_component:latest\", \"name\": \"Second component\",
          \"produces\": {\"embeddings\": {\"fields\": {\"data\": {\"items\": {\"type\":
          \"float32\"}, \"type\": \"array\"}}}}}", "input_partition_rows": "10", "metadata":
          "{\"base_path\": \"/foo/bar\", \"pipeline_name\": \"test_pipeline\", \"run_id\":
          \"test_pipeline-20230101000000\", \"component_id\": \"second_component\",
          \"cache_key\": \"2\"}", "storage_args": "a dummy string arg"}'
        pipelines.kubeflow.org/component_ref: '{"digest": "db87221bec0b879c41e2e67da3f6f6ce69d40000b7d51b9601cda51f57cc0851"}'
        pipelines.kubeflow.org/component_spec: '{"description": "This is an example
          component", "implementation": {"container": {"command": ["fondant", "execute",
          "main", "--input_manifest_path", {"inputPath": "input_manifest_path"}, "--metadata",
          {"inputValue": "metadata"}, "--component_spec", {"inputValue": "component_spec"},
          "--input_partition_rows", {"inputValue": "input_partition_rows"}, "--column_mapping",
          {"inputValue": "column_mapping"}, "--cache", {"inputValue": "cache"}, "--storage_args",
          {"inputValue": "storage_args"}, "--output_manifest_path", {"outputPath":
          "output_manifest_path"}, "--cluster_type", {"inputValue": "cluster_type"},
          "--client_kwargs", {"inputValue": "client_kwargs"}], "image": "example_component:latest"}},
          "inputs": [{"description": "Path to the input manifest", "name": "input_manifest_path",
          "type": "String"}, {"description": "Metadata arguments containing the run
          id and base path", "name": "metadata", "type": "String"}, {"default": "None",
          "description": "The component specification as a dictionary", "name": "component_spec",
          "type": "JsonObject"}, {"default": "None", "description": "The number of
          rows to load per partition. Set to override the automatic partitioning",
          "name": "input_partition_rows", "type": "String"}, {"default": "None", "description":
          "A dictionary that maps the column names of the consumed dataset to other
          column names that match a given component specification", "name": "column_mapping",
          "type": "JsonObject"}, {"default": "True", "description": "Set to False
          to disable caching, True by default.", "name": "cache", "type": "Boolean"},
          {"default": "default", "description": "The type of cluster to use for distributed
          execution", "name": "cluster_type", "type": "String"}, {"default": "{}",
          "description": "Keyword arguments used to initialise the dask client", "name":
          "client_kwargs", "type": "JsonObject"}, {"description": "Storage arguments",
          "name": "storage_args", "type": "String"}], "name": "Second component",
          "outputs": [{"description": "Path to the output manifest", "name": "output_manifest_path",
          "type": "String"}]}'
      labels:
        pipelines.kubeflow.org/enable_caching: 'true'
        pipelines.kubeflow.org/kfp_sdk_version: 1.8.22
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
    name: second-component
    outputs:
      artifacts:
      - name: second-component-output_manifest_path
        path: /tmp/outputs/output_manifest_path/data
  - dag:
      tasks:
      - name: first-component
        template: first-component
      - arguments:
          artifacts:
          - from: '{{tasks.first-component.outputs.artifacts.first-component-output_manifest_path}}'
            name: first-component-output_manifest_path
        dependencies:
        - first-component
        name: second-component
        template: second-component
      - arguments:
          artifacts:
          - from: '{{tasks.second-component.outputs.artifacts.second-component-output_manifest_path}}'
            name: second-component-output_manifest_path
        dependencies:
        - second-component
        name: third-component
        template: third-component
    name: test-pipeline
  - container:
      args: []
      command:
      - fondant
      - execute
      - main
      - --input_manifest_path
      - /tmp/inputs/input_manifest_path/data
      - --metadata
      - '{"base_path": "/foo/bar", "pipeline_name": "test_pipeline", "run_id": "test_pipeline-20230101000000",
        "component_id": "third_component", "cache_key": "3"}'
      - --component_spec
      - '{"args": {"storage_args": {"description": "Storage arguments", "type": "str"}},
        "consumes": {"captions": {"fields": {"data": {"type": "string"}}}, "embeddings":
        {"fields": {"data": {"items": {"type": "float32"}, "type": "array"}}}, "images":
        {"fields": {"data": {"type": "binary"}}}}, "description": "This is an example
        component", "image": "example_component:latest", "name": "Third component",
        "produces": {"additionalSubsets": false, "images": {"fields": {"data": {"type":
        "binary"}}}}}'
      - --input_partition_rows
      - None
      - --column_mapping
      - None
      - --cache
      - 'True'
      - --storage_args
      - a dummy string arg
      - --output_manifest_path
      - /tmp/outputs/output_manifest_path/data
      - --cluster_type
      - default
      - --client_kwargs
      - '{}'
      image: example_component:latest
      imagePullPolicy: Always
    inputs:
      artifacts:
      - name: second-component-output_manifest_path
        path: /tmp/inputs/input_manifest_path/data
    metadata:
      annotations:
        pipelines.kubeflow.org/arguments.parameters: '{"cache": "True", "client_kwargs":
          "{}", "cluster_type": "default", "column_mapping": "None", "component_spec":
          "{\"args\": {\"storage_args\": {\"description\": \"Storage arguments\",
          \"type\": \"str\"}}, \"consumes\": {\"captions\": {\"fields\": {\"data\":
          {\"type\": \"string\"}}}, \"embeddings\": {\"fields\": {\"data\": {\"items\":
          {\"type\": \"float32\"}, \"type\": \"array\"}}}, \"images\": {\"fields\":
          {\"data\": {\"type\": \"binary\"}}}}, \"description\": \"This is an example
          component\", \"image\": \"example_component:latest\", \"name\": \"Third
          component\", \"produces\": {\"additionalSubsets\": false, \"images\": {\"fields\":
          {\"data\": {\"type\": \"binary\"}}}}}", "input_partition_rows": "None",
          "metadata": "{\"base_path\": \"/foo/bar\", \"pipeline_name\": \"test_pipeline\",
          \"run_id\": \"test_pipeline-20230101000000\", \"component_id\": \"third_component\",
          \"cache_key\": \"3\"}", "storage_args": "a dummy string arg"}'
        pipelines.kubeflow.org/component_ref: '{"digest": "cc04ee687e0437877006707dfa1624770ccdf4de50a2b0da23305b10763380fd"}'
        pipelines.kubeflow.org/component_spec: '{"description": "This is an example
          component", "implementation": {"container": {"command": ["fondant", "execute",
          "main", "--input_manifest_path", {"inputPath": "input_manifest_path"}, "--metadata",
          {"inputValue": "metadata"}, "--component_spec", {"inputValue": "component_spec"},
          "--input_partition_rows", {"inputValue": "input_partition_rows"}, "--column_mapping",
          {"inputValue": "column_mapping"}, "--cache", {"inputValue": "cache"}, "--storage_args",
          {"inputValue": "storage_args"}, "--output_manifest_path", {"outputPath":
          "output_manifest_path"}, "--cluster_type", {"inputValue": "cluster_type"},
          "--client_kwargs", {"inputValue": "client_kwargs"}], "image": "example_component:latest"}},
          "inputs": [{"description": "Path to the input manifest", "name": "input_manifest_path",
          "type": "String"}, {"description": "Metadata arguments containing the run
          id and base path", "name": "metadata", "type": "String"}, {"default": "None",
          "description": "The component specification as a dictionary", "name": "component_spec",
          "type": "JsonObject"}, {"default": "None", "description": "The number of
          rows to load per partition. Set to override the automatic partitioning",
          "name": "input_partition_rows", "type": "String"}, {"default": "None", "description":
          "A dictionary that maps the column names of the consumed dataset to other
          column names that match a given component specification", "name": "column_mapping",
          "type": "JsonObject"}, {"default": "True", "description": "Set to False
          to disable caching, True by default.", "name": "cache", "type": "Boolean"},
          {"default": "default", "description": "The type of cluster to use for distributed
          execution", "name": "cluster_type", "type": "String"}, {"default": "{}",
          "description": "Keyword arguments used to initialise the dask client", "name":
          "client_kwargs", "type": "JsonObject"}, {"description": "Storage arguments",
          "name": "storage_args", "type": "String"}], "name": "Third component", "outputs":
          [{"description": "Path to the output manifest", "name": "output_manifest_path",
          "type": "String"}]}'
      labels:
        pipelines.kubeflow.org/enable_caching: 'true'
        pipelines.kubeflow.org/kfp_sdk_version: 1.8.22
        pipelines.kubeflow.org/pipeline-sdk-type: kfp
    name: third-component
    outputs:
      artifacts:
      - name: third-component-output_manifest_path
        path: /tmp/outputs/output_manifest_path/data
